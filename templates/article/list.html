<!-- extends表明此页面继承自 base.html 文件 -->
{% extends "base.html" %}
{% load static %}
{% load my_filters_and_tags %}

<!-- 写入 base.html 中定义的 title -->
{% block title %}
    首页
{% endblock title %}

<!-- 写入 base.html 中定义的 content -->
{% block content %}

<!-- 定义放置文章标题的div容器 -->
<div class="container">
    <hr>
    <!-- 面包屑导航 -->
    <nav aria-label="breadcrumb" class="top-nav py-1 bg-light">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="{% url 'article:article_list' %}?search={{ search }}&column={{ column }}&tag={{ tag }}">
                    最新
                </a>
            </li>
            <li class="breadcrumb-item">
                <a href="{% url 'article:article_list' %}?order=total_views&search={{ search }}&column={{ column }}&tag={{ tag }}">
                    最热
                </a>
            </li>
        </ol>
        <!-- 搜索栏 -->
        <form class="form-inline" >
            <label class="sr-only">content</label>
            <input type="text"
                class="form-control mr-sm-2"
                name="search"
                placeholder="搜索文章..."
                required
            >
        <!-- 搜索提示语 -->
        {% if search %}
            {% if articles %}
                <h4><span style="color: red">"{{ search }}"</span>的搜索结果如下：</h4>
                <hr>
            {% else %}
                <h4>暂无<span style="color: red">"{{ search }}"</span>有关的文章。</h4>
                <hr>
            {% endif %}
        {% endif %}
    </nav>
    <hr>

    <!-- 列表循环 -->
    <div class="row mt-2">
        {% for article in articles %}
            <!-- 文章内容 -->
            
            <!-- 标题图 -->
            {% if article.avatar %}
                <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-3">
                    <img src="{{ article.avatar.url }}" 
                         alt="avatar" 
                         style="max-width:100%; border-radius: 20px"
                    >
                </div>
            {% endif %}

            <div class="col">
                <!-- 栏目 -->
                {% if article.column %}
                    <a  role="button" 
                        href="{% url 'article:article_list' %}?column={{ article.column.id }}"
                        class="btn btn-sm mb-2
                            {% if article.column.title == 'Django' %}
                                btn-success
                            {% elif article.column.title == 'Java' %}
                                btn-danger
                            {% elif article.column.title == 'HTML' %}
                                btn-warning
                            {% endif %}
                        "
                    >
                        {{ article.column }}
                    </a>
                {% endif %}

                <!-- 标签 -->
                <span>
                    {% for tag in article.tags.all %}
                        <a href="{% url 'article:article_list' %}?tag={{ tag }}"
                           class="badge badge-secondary" 
                        >
                            {{ tag }}
                        </a>
                    {% endfor %}
                </span>

                <!-- 标题 -->
                <h4>
                    <b>
                        <a href="{% url 'article:article_detail' article.id %}"
                           style="color: black;" 
                        >
                            {{ article.title }}
                        </a>
                    </b>
                </h4>
                <!-- 摘要 -->
                <div>
                    <p style="color: gray;">
                        {{ article.body|slice:'100' }}...
                    </p>
                </div>
                <!-- 注脚 -->
                <p>
                    <!-- 附加信息 -->
                    <span>
                        <i class="fas fa-eye" style="color: lightskyblue;"></i>
                        {{ article.total_views }}&nbsp;&nbsp;&nbsp;
                    </span>
                    <span>
                        <i class="fas fa-comments" style="color: yellowgreen;"></i>
                        {{ article.comments.count }}&nbsp;&nbsp;&nbsp;
                    </span>
                    <span>
                        <i class="fas fa-clock" style="color: pink;"></i>
                        <!--
                        {{ article.created|date:'Y-m-d' }}
                        -->
                        {{ article.created|timesince_zh }}
                    </span>
                </p>
            </div>
            <hr style="width: 100%;"/>
        {% endfor %}
    </div>

    <!-- 修改为方形分页导航 -->
    <nav aria-label="Page navigation" class="my-4">
        <div class="d-flex justify-content-center align-items-center">
            <ul class="pagination mb-0">
                <!-- 上一页按钮 -->
                {% if articles.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ articles.previous_page_number }}&order={{ order }}&search={{ search }}&column={{ column }}&tag={{ tag }}" aria-label="Previous">
                            <span aria-hidden="true">&lt;</span>
                        </a>
                    </li>
                {% else %}
                    <li class="page-item disabled">
                        <a class="page-link" href="#" aria-label="Previous">
                            <span aria-hidden="true">&lt;</span>
                        </a>
                    </li>
                {% endif %}
                
                <!-- 页码显示逻辑 -->
                {% if articles.paginator.num_pages > 1 %}
                    <!-- 第一页始终显示 -->
                    <li class="page-item {% if articles.number == 1 %}active{% endif %}">
                        <a class="page-link" href="?page=1&order={{ order }}&search={{ search }}&column={{ column }}&tag={{ tag }}">1</a>
                    </li>
                    
                    <!-- 省略号(如果当前页>=4) -->
                    {% if articles.number >= 4 %}
                        <li class="page-item disabled">
                            <span class="page-link">...</span>
                        </li>
                    {% endif %}
                    
                    <!-- 当前页周围的页码 -->
                    {% for i in articles.paginator.page_range %}
                        {% if i > 1 and i < articles.paginator.num_pages %}
                            {% if i >= articles.number|add:"-1" and i <= articles.number|add:"1" %}
                                <li class="page-item {% if articles.number == i %}active{% endif %}">
                                    <a class="page-link" href="?page={{ i }}&order={{ order }}&search={{ search }}&column={{ column }}&tag={{ tag }}">{{ i }}</a>
                                </li>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                    
                    <!-- 省略号(如果当前页<=最大页数-3) -->
                    {% if articles.number <= articles.paginator.num_pages|add:"-3" %}
                        <li class="page-item disabled">
                            <span class="page-link">...</span>
                        </li>
                    {% endif %}
                    
                    <!-- 最后一页始终显示 -->
                    {% if articles.paginator.num_pages > 1 %}
                        <li class="page-item {% if articles.number == articles.paginator.num_pages %}active{% endif %}">
                            <a class="page-link" href="?page={{ articles.paginator.num_pages }}&order={{ order }}&search={{ search }}&column={{ column }}&tag={{ tag }}">{{ articles.paginator.num_pages }}</a>
                        </li>
                    {% endif %}
                {% endif %}
                
                <!-- 下一页按钮 -->
                {% if articles.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ articles.next_page_number }}&order={{ order }}&search={{ search }}&column={{ column }}&tag={{ tag }}" aria-label="Next">
                            <span aria-hidden="true">&gt;</span>
                        </a>
                    </li>
                {% else %}
                    <li class="page-item disabled">
                        <a class="page-link" href="#" aria-label="Next">
                            <span aria-hidden="true">&gt;</span>
                        </a>
                    </li>
                {% endif %}
            </ul>
            
            <!-- 跳转到指定页 -->
            <div class="ml-3 d-flex align-items-center">
                <span class="mr-2">跳至</span>
                <input type="number" min="1" max="{{ articles.paginator.num_pages }}" class="form-control" style="width: 60px;" id="pageJumpInput">
                <span class="ml-2">页</span>
                <button class="btn btn-sm btn-outline-secondary ml-2" id="pageJumpButton">确定</button>
            </div>
        </div>
    </nav>

    <!-- 页面跳转脚本 -->
    <script>
        document.getElementById('pageJumpButton').addEventListener('click', function() {
            const pageInput = document.getElementById('pageJumpInput');
            const pageNum = parseInt(pageInput.value);
            if (pageNum && pageNum >= 1 && pageNum <= {{ articles.paginator.num_pages }}) {
                window.location.href = "?page=" + pageNum + "&order={{ order }}&search={{ search }}&column={{ column }}&tag={{ tag }}";
            }
        });
        
        document.getElementById('pageJumpInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('pageJumpButton').click();
            }
        });
    </script>
</div>

<style>
    .top-nav {
        display: flex;
        justify-content: space-between;  
        align-items: center;             
    }

    .breadcrumb {
        background-color: transparent;
        margin-bottom: 0;
    }
    
    /* 方形分页样式 */
    .pagination .page-link {
        border-radius: 0;
        margin: 0 2px;
        min-width: 40px;
        height: 40px;
        text-align: center;
        line-height: 24px;
        font-weight: 500;
    }
    
    .pagination .page-item.active .page-link {
        background-color: #fff;
        color: #000;
        border: 2px solid #000;
        font-weight: bold;
    }
    
    .pagination .page-link:hover {
        background-color: #f8f9fa;
        border-color: #dee2e6;
        color: #000;
    }
    
    .pagination .page-item.disabled .page-link {
        color: #6c757d;
        pointer-events: none;
        background-color: #fff;
        border-color: #dee2e6;
    }
    
    @media (max-width: 576px) { 
        .form-inline input[type="text"] {
            width: 100%;
            margin: 10px 0; 
        }
        .form-inline .form-control {
            width: 100%; 
        }
    }
    @media (max-width: 576px) {
    .form-inline {
        width: auto;
        padding: 0 15px; 
        }
    }


</style>

{% endblock content %}
